@model IEnumerable<UrosPetrusovic.Models.Order>

@{
    ViewData["Title"] = "Moje Porudžbine";
}

<div class="container" style="padding-top: 150px; padding-bottom: 50px;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold m-0">📋 Moje Porudžbine</h2>
        <a asp-controller="Items" asp-action="Index" class="btn btn-outline-secondary btn-sm rounded-pill px-3">
            Nazad na katalog
        </a>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show border-0 shadow-sm rounded-3 mb-4" role="alert">
            @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (Model != null && Model.Any())
    {
        <div class="row g-4">
            @foreach (var order in Model)
            {
                <div class="col-md-6 col-lg-4">
                    <div class="card border-0 shadow-sm rounded-4 h-100 transition-hover">
                        <div class="card-body p-4 d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <span class="text-muted small fw-bold">ID: #@order.Id</span>

                                @{
                                    string statusClass = order.Status switch
                                    {
                                        "Na čekanju" => "bg-warning text-dark",
                                        "Otkazano" => "bg-danger text-white",
                                        "Potvrđeno" => "bg-success text-white",
                                        "Poslato" => "bg-info text-white",
                                        _ => "bg-success text-white"
                                    };
                                }
                                <span class="badge rounded-pill px-3 py-2 @statusClass">
                                    @order.Status
                                </span>
                            </div>

                            <div class="mb-3">
                                <small class="text-muted d-block">Datum porudžbine:</small>
                                <span class="fw-bold">@order.OrderDate.ToString("dd.MM.yyyy HH:mm")</span>
                            </div>

                            <div class="mb-4 mt-auto">
                                <small class="text-muted d-block">Ukupan iznos:</small>
                                <h3 class="text-primary fw-bold mb-0">
                                    @(order.OrderItems.Sum(oi => oi.UnitPrice * oi.Quantity).ToString("N2")) RSD
                                </h3>
                            </div>

                            <div class="d-grid gap-2">
                                @if (order.Status == "Na čekanju")
                                {
                                    <a asp-action="Edit" asp-route-id="@order.Id"
                                       class="btn btn-primary rounded-pill fw-bold shadow-sm">
                                        ✏️ Izmeni porudžbinu
                                    </a>
                                }
                                else
                                {
                                    <button class="btn btn-light disabled rounded-pill border py-2 text-muted fw-bold">
                                        @if (order.Status == "Otkazano")
                                        {
                                            <span>❌ Porudžbina otkazana</span>
                                        }
                                        else
                                        {
                                            <span>🔒 Zaključano (Potvrđeno)</span>
                                        }
                                    </button>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="text-center py-5 bg-light rounded-4 border-dashed mt-4">
            <div class="display-1 text-muted mb-3">📦</div>
            <h4 class="text-muted">Još uvek niste napravili nijednu porudžbinu.</h4>
            <a asp-controller="Items" asp-action="Index" class="btn btn-primary mt-3 px-4 rounded-pill">
                Započni kupovinu
            </a>
        </div>
    }
</div>

<style>
    .transition-hover {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }

        .transition-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 .5rem 1rem rgba(0,0,0,.15) !important;
        }

    .border-dashed {
        border: 2px dashed #dee2e6;
    }
</style>